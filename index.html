<!DOCTYPE html>
<html lang="mr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>рдЦреЗрд░реНрдбрд╛ рд░рд╛рдЬрд╕реНрд╡ рдордВрдбрд│</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+Devanagari:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <header class="glass-header">
        <div class="container header-content">
            <div class="logo-wrapper">
                <img src="assets/logo.png" alt="Logo" class="logo">
                <h1 class="title">рдЦреЗрд░реНрдбрд╛ рд░рд╛рдЬрд╕реНрд╡ рдордВрдбрд│</h1>
            </div>
            <nav class="nav">
                <ul>
                    <li><a href="#" class="active">рдореБрдЦреНрдпрдкреГрд╖реНрда</a></li>
                    <li><a href="#">рдЖрдордЪреНрдпрд╛рдмрджреНрджрд▓</a></li>
                    <li><a href="#">рд╕реЗрд╡рд╛</a></li>
                    <li><a href="#">рд╕рдВрдкрд░реНрдХ</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="content">
        <div class="container">
            <div class="stats-grid">
                <section class="card officer-card">
                    <div class="officer-img-wrapper">
                        <img src="assets/officer.png" alt="Circle Officer" class="officer-img">
                    </div>
                    <div class="officer-text">
                        <span class="badge">рдордВрдбрд│ рдЕрдзрд┐рдХрд╛рд░реА рдбреЗрд╕реНрдХ</span>
                        <h3 id="displayTitle" class="skeleton-text" style="min-height: 28px; width: 80%;"></h3>

                        <!-- Fixed: Message-specific image now fits in body -->
                        <div id="msgImgContainer"
                            style="display: none; margin: 1rem 0; border-radius: 10px; overflow: hidden; border: 1px solid var(--glass-border);">
                            <img id="displayMsgImg" src="" alt="Message Content"
                                style="width: 100%; height: auto; display: block;">
                        </div>

                        <p id="displayContent" class="skeleton-text" style="min-height: 60px;"></p>

                        <div id="videoContainer" style="margin-top: 1rem; display: none;">
                            <a href="#" id="displayVideo" target="_blank" class="read-more"
                                style="background: var(--accent); color: var(--primary); padding: 0.5rem 1rem; border-radius: 5px; display: inline-block;">рд╡реНрд╣рд┐рдбреАрдУ
                                рдкрд╣рд╛ ЁЯОе</a>
                        </div>
                        <a href="#" class="read-more">рдкреВрд░реНрдг рд╡рд╛рдЪрд╛ тЖТ</a>
                    </div>
                </section>

                <script>
                    const SUPABASE_URL = 'https://wqiimtgghapvwxsmqpfi.supabase.co';
                    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndxaWltdGdnaGFwdnd4c21xcGZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2MzkzOTgsImV4cCI6MjA4NDIxNTM5OH0.Xlx4NES8640ufpoa-VqOjHVGxats7qBbsM1vHsnZxII';
                    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

                    async function loadOfficerData() {
                        const { data, error } = await supabaseClient
                            .from('officer_messages')
                            .select('*')
                            .order('created_at', { ascending: false })
                            .limit(1)
                            .maybeSingle();

                        if (error) {
                            console.error('Error fetching data:', error);
                            const savedData = localStorage.getItem('officerDeskData');
                            if (savedData) applyData(JSON.parse(savedData));
                            return;
                        }

                        if (data) {
                            applyData({
                                title: data.title,
                                content: data.content,
                                img: data.image_data,
                                imgSize: data.image_size,
                                imgRatio: data.image_ratio,
                                video: data.video_url
                            });
                        }
                    }

                    function applyData(data) {
                        if (data.title) {
                            const titleEl = document.getElementById('displayTitle');
                            titleEl.innerText = data.title;
                            titleEl.classList.remove('skeleton-text');
                            titleEl.style.width = 'auto';
                        }
                        if (data.content) {
                            const contentEl = document.getElementById('displayContent');
                            contentEl.innerText = data.content;
                            contentEl.classList.remove('skeleton-text');
                        }

                        if (data.img) {
                            const container = document.getElementById('msgImgContainer');
                            const img = document.getElementById('displayMsgImg');
                            container.style.display = 'block';
                            img.src = data.img;
                            container.style.width = (data.imgSize || 100) + '%';
                            container.style.margin = '1rem auto';

                            if (data.imgRatio && data.imgRatio !== 'original') {
                                container.style.aspectRatio = data.imgRatio.replace('/', ' / ');
                                img.style.height = '100%';
                                img.style.objectFit = 'cover';
                            } else {
                                container.style.aspectRatio = 'auto';
                            }
                        } else {
                            document.getElementById('msgImgContainer').style.display = 'none';
                        }

                        if (data.video) {
                            const vContainer = document.getElementById('videoContainer');
                            vContainer.style.display = 'block';
                            document.getElementById('displayVideo').href = data.video;
                            vContainer.style.width = '100%';
                            vContainer.style.margin = '1rem auto 0 auto';
                        } else {
                            document.getElementById('videoContainer').style.display = 'none';
                        }
                    }

                    supabaseClient
                        .channel('public:officer_messages')
                        .on('postgres_changes', { event: '*', schema: 'public', table: 'officer_messages' }, payload => {
                            console.log('New update received!', payload);

                            // Visual notification
                            const badge = document.querySelector('.badge');
                            const originalText = badge.innerText;
                            const originalColor = badge.style.background;

                            badge.style.background = '#22c55e'; // Green color
                            badge.innerText = 'ЁЯФФ рдирд╡реАрди рдЕрдкрдбреЗрдЯ рдЖрд▓реЗ!';
                            badge.style.transition = 'all 0.3s ease';

                            setTimeout(() => {
                                badge.style.background = originalColor;
                                badge.innerText = originalText;
                            }, 3000);

                            loadOfficerData();
                        })
                        .subscribe();

                    window.addEventListener('DOMContentLoaded', loadOfficerData);
                </script>
                <section class="card glass-card">
                    <div class="card-icon">ЁЯУВ</div>
                    <h3>рдорд╣рд╕реВрд▓ рджрд╕реНрддрдРрд╡рдЬ</h3>
                    <p>рд╕рд╛рддрдмрд╛рд░рд╛, реордЕ рдЖрдгрд┐ рдЗрддрд░ рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ рджрд╕реНрддрдРрд╡рдЬ рдорд┐рд│рд╡рд╛.</p>
                </section>
                <section class="card glass-card">
                    <div class="card-icon">ЁЯдЭ</div>
                    <h3>рдЬрдирд╕рдВрдкрд░реНрдХ</h3>
                    <p>рдирд╛рдЧрд░рд┐рдХрд╛рдВрдЪреНрдпрд╛ рд╕рдорд╕реНрдпрд╛ рдЖрдгрд┐ рддрдХреНрд░рд╛рд░ рдирд┐рд╡рд╛рд░рдг рд╡рд┐рднрд╛рдЧ.</p>
                </section>
                <section class="card glass-card">
                    <div class="card-icon">ЁЯУв</div>
                    <h3>рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рд╕реВрдЪрдирд╛</h3>
                    <p>рд╢рд╛рд╕рдХреАрдп рдкрд░рд┐рдкрддреНрд░рдХреЗ рдЖрдгрд┐ рдирд╡реАрди рдШреЛрд╖рдгрд╛рдВрдЪреА рдорд╛рд╣рд┐рддреА.</p>
                </section>
            </div>
        </div>
    </main>

    <footer class="premium-footer">
        <div class="container footer-content">
            <p>&copy; 2026 Dnit Office Soutions, Karanja. рд╕рд░реНрд╡ рд╣рдХреНрдХ рд░рд╛рдЦреАрд╡.</p>
        </div>
    </footer>
</body>

</html>